# .github/workflows/vita_builds.yml
name: "ðŸŽ® PSVita Builds"

on:
  push:        # trigger on every push
  pull_request # and on every PR

env:
  GODOT_BRANCH: "3.x"
  VITASDK_DIR: /usr/local/vitasdk

  # softfp v2.228 (â€œfatâ€) SDK tarball
  VITA_SDK_URL: https://github.com/vitasdk/buildscripts/releases/download/softfp-linux-v2.228
  VITA_SDK_TAR: vitasdk-x86_64-linux-gnu-2022-08-14_14-50-39.tar.bz2

  # pinned repos (2024 SHAs)
  VDPM_COMMIT: "426032a2fd05300cf9ef04e5f691f07f642c14cf"
  VITA_PACKAGES_EXTRA_COMMIT: "6000b5630c3a7fc2fb368293dd35560bd2e72e0f"

concurrency:
  group: "ci-${{ github.actor }}-${{ github.head_ref || github.run_number }}-${{ github.ref }}-vita"
  cancel-in-progress: true

jobs:
  vita-template:
    runs-on: ubuntu-24.04
    name: Vita Template Build

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install build dependencies
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y \
            cmake libarchive-tools fakeroot zip wget git-core \
            libelf-dev build-essential autoconf texinfo bison flex libtool \
            libgl1-mesa-dev libglu1-mesa-dev libx11-dev libxrandr-dev \
            libxinerama-dev libxext-dev libxi-dev libxfixes-dev libxcursor-dev

      - name: Install VitaSDK (softfp v2.228)
        run: |
          sudo rm -rf "$VITASDK_DIR" && sudo mkdir -p "$VITASDK_DIR"
          wget -q "$VITA_SDK_URL/$VITA_SDK_TAR" -O sdk.tar.bz2
          sudo tar --strip-components=1 -xjf sdk.tar.bz2 -C "$VITASDK_DIR"
          sudo chown -R "$USER:$USER" "$VITASDK_DIR"
          echo "$VITASDK_DIR/bin" >> "$GITHUB_PATH"
          arm-vita-eabi-gcc --version

      # â”€â”€â”€â”€â”€ additional steps (vdpm, vita-packages-extra, SCons build, packaging) go here â”€â”€â”€â”€â”€
